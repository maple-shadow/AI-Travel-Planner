# AI旅行规划师 - 模块详细设计文档

## 1. 前端模块详细设计

### 1.1 核心模块 (Core Modules)

#### 1.1.1 认证模块 (auth)
```
frontend/src/core/auth/
├── components/
│   ├── LoginForm.tsx          # 登录表单组件
│   ├── RegisterForm.tsx       # 注册表单组件
│   └── AuthGuard.tsx          # 路由守卫组件
├── hooks/
│   ├── useAuth.ts             # 认证状态Hook
│   └── useAuthActions.ts      # 认证操作Hook
├── services/
│   └── authService.ts         # 认证API服务
├── types/
│   └── auth.types.ts          # 认证相关类型
└── index.ts                   # 模块导出
```

#### 1.1.2 路由模块 (router)
```
frontend/src/core/router/
├── routes/
│   ├── public.routes.tsx      # 公开路由
│   ├── private.routes.tsx     # 私有路由
│   └── index.tsx              # 路由配置
├── components/
│   └── AppRouter.tsx          # 路由组件
└── index.ts                   # 模块导出
```

#### 1.1.3 状态管理模块 (store)
```
frontend/src/core/store/
├── slices/
│   ├── auth.slice.ts          # 认证状态切片
│   ├── user.slice.ts          # 用户状态切片
│   └── ui.slice.ts            # UI状态切片
├── api/
│   ├── auth.api.ts            # 认证API
│   ├── trips.api.ts           # 行程API
│   └── budgets.api.ts         # 预算API
├── hooks/
│   └── index.ts               # Store Hooks
└── index.ts                   # Store配置
```

### 1.2 功能模块 (Feature Modules)

#### 1.2.1 行程规划模块 (trip-planning)
```
frontend/src/features/trip-planning/
├── components/
│   ├── TripForm.tsx           # 行程表单组件
│   ├── TripList.tsx           # 行程列表组件
│   ├── TripDetail.tsx         # 行程详情组件
│   └── TripCard.tsx           # 行程卡片组件
├── hooks/
│   ├── useTripForm.ts         # 行程表单Hook
│   └── useTripActions.ts      # 行程操作Hook
├── services/
│   └── tripService.ts         # 行程API服务
├── types/
│   └── trip.types.ts          # 行程相关类型
└── pages/
    ├── TripPlanningPage.tsx   # 行程规划页面
    └── TripDetailPage.tsx     # 行程详情页面
```

#### 1.2.2 预算管理模块 (budget-manager)
```
frontend/src/features/budget-manager/
├── components/
│   ├── BudgetForm.tsx         # 预算表单组件
│   ├── BudgetChart.tsx        # 预算图表组件
│   ├── ExpenseList.tsx        # 开销列表组件
│   └── ExpenseForm.tsx        # 开销表单组件
├── hooks/
│   ├── useBudgetAnalysis.ts   # 预算分析Hook
│   └── useExpenseTracking.ts  # 开销追踪Hook
├── services/
│   └── budgetService.ts       # 预算API服务
└── types/
    └── budget.types.ts        # 预算相关类型
```

#### 1.2.3 用户资料模块 (user-profile)
```
frontend/src/features/user-profile/
├── components/
│   ├── ProfileForm.tsx        # 资料表单组件
│   ├── ProfileAvatar.tsx      # 头像组件
│   └── SettingsPanel.tsx      # 设置面板组件
├── hooks/
│   └── useProfile.ts          # 用户资料Hook
└── services/
    └── userService.ts         # 用户API服务
```

#### 1.2.4 地图导航模块 (map-navigation)
```
frontend/src/features/map-navigation/
├── components/
│   ├── MapContainer.tsx       # 地图容器组件
│   ├── LocationPicker.tsx    # 位置选择组件
│   └── RouteDisplay.tsx       # 路线显示组件
├── hooks/
│   ├── useMap.ts              # 地图Hook
│   └── useGeolocation.ts      # 定位Hook
└── services/
    └── mapService.ts          # 地图API服务
```

### 1.3 共享模块 (Shared Modules)

#### 1.3.1 通用组件 (components)
```
frontend/src/shared/components/
├── ui/
│   ├── Button.tsx             # 按钮组件
│   ├── Input.tsx              # 输入框组件
│   ├── Modal.tsx              # 模态框组件
│   └── Loading.tsx            # 加载组件
├── layout/
│   ├── Header.tsx             # 头部组件
│   ├── Sidebar.tsx            # 侧边栏组件
│   └── Footer.tsx             # 底部组件
└── forms/
    ├── FormField.tsx          # 表单字段组件
    └── ValidationMessage.tsx  # 验证消息组件
```

#### 1.3.2 自定义Hooks (hooks)
```
frontend/src/shared/hooks/
├── useLocalStorage.ts         # 本地存储Hook
├── useDebounce.ts             # 防抖Hook
├── useApi.ts                  # API调用Hook
└── useToast.ts                # 消息提示Hook
```

#### 1.3.3 工具函数 (utils)
```
frontend/src/shared/utils/
├── formatters/
│   ├── dateFormatter.ts       # 日期格式化
│   ├── currencyFormatter.ts   # 货币格式化
│   └── numberFormatter.ts     # 数字格式化
├── validators/
│   ├── formValidators.ts      # 表单验证
│   └── schemaValidators.ts    # 模式验证
└── helpers/
    ├── arrayHelpers.ts        # 数组工具
    └── objectHelpers.ts       # 对象工具
```

## 2. 后端模块详细设计

### 2.1 核心模块 (Core Modules)

#### 2.1.1 配置模块 (config)
```
backend/src/core/config/
├── database.config.ts         # 数据库配置
├── server.config.ts           # 服务器配置
├── auth.config.ts             # 认证配置
├── ai.config.ts               # AI服务配置
└── index.ts                   # 配置导出
```

#### 2.1.2 中间件模块 (middleware)
```
backend/src/core/middleware/
├── auth.middleware.ts         # 认证中间件
├── validation.middleware.ts   # 验证中间件
├── error.middleware.ts        # 错误处理中间件
├── logging.middleware.ts      # 日志中间件
└── cors.middleware.ts         # CORS中间件
```

#### 2.1.3 数据库模块 (database)
```
backend/src/core/database/
├── connection.ts              # 数据库连接
├── migrations/                 # 数据库迁移
├── seeds/                     # 种子数据
└── models/                    # 数据模型基类
```

### 2.2 业务模块 (Business Modules)

#### 2.2.1 认证模块 (auth)
```
backend/src/modules/auth/
├── controllers/
│   ├── auth.controller.ts     # 认证控制器
│   └── token.controller.ts     # Token控制器
├── services/
│   ├── auth.service.ts         # 认证服务
│   └── token.service.ts        # Token服务
├── middleware/
│   └── auth.middleware.ts      # 认证中间件
├── validators/
│   └── auth.validators.ts      # 认证验证器
└── routes/
    └── auth.routes.ts          # 认证路由
```

#### 2.2.2 用户模块 (users)
```
backend/src/modules/users/
├── controllers/
│   └── user.controller.ts      # 用户控制器
├── services/
│   └── user.service.ts         # 用户服务
├── models/
│   └── user.model.ts           # 用户模型
├── validators/
│   └── user.validators.ts      # 用户验证器
└── routes/
    └── user.routes.ts          # 用户路由
```

#### 2.2.3 行程模块 (trips)
```
backend/src/modules/trips/
├── controllers/
│   └── trip.controller.ts      # 行程控制器
├── services/
│   ├── trip.service.ts         # 行程服务
│   └── ai.trip.service.ts      # AI行程服务
├── models/
│   └── trip.model.ts           # 行程模型
├── validators/
│   └── trip.validators.ts      # 行程验证器
└── routes/
    └── trip.routes.ts          # 行程路由
```

#### 2.2.4 预算模块 (budgets)
```
backend/src/modules/budgets/
├── controllers/
│   └── budget.controller.ts    # 预算控制器
├── services/
│   ├── budget.service.ts       # 预算服务
│   └── expense.service.ts      # 开销服务
├── models/
│   ├── budget.model.ts         # 预算模型
│   └── expense.model.ts        # 开销模型
├── validators/
│   └── budget.validators.ts    # 预算验证器
└── routes/
    └── budget.routes.ts        # 预算路由
```

#### 2.2.5 AI服务模块 (ai-services)
```
backend/src/modules/ai-services/
├── services/
│   ├── ai.trip.service.ts      # AI行程规划服务
│   ├── ai.budget.service.ts    # AI预算分析服务
│   └── ai.voice.service.ts     # AI语音服务
├── clients/
│   ├── aliyun.client.ts        # 阿里云客户端
│   └── iflytek.client.ts       # 科大讯飞客户端
└── utils/
    └── ai.utils.ts             # AI工具函数
```

### 2.3 共享模块 (Shared Modules)

#### 2.3.1 类型定义 (types)
```
backend/src/shared/types/
├── auth.types.ts              # 认证类型
├── user.types.ts              # 用户类型
├── trip.types.ts              # 行程类型
├── budget.types.ts             # 预算类型
└── common.types.ts             # 通用类型
```

#### 2.3.2 常量定义 (constants)
```
backend/src/shared/constants/
├── error.codes.ts             # 错误码
├── http.status.ts             # HTTP状态码
├── validation.rules.ts        # 验证规则
└── app.constants.ts           # 应用常量
```

#### 2.3.3 验证器 (validators)
```
backend/src/shared/validators/
├── schema.validators.ts       # 模式验证器
├── input.validators.ts        # 输入验证器
└── custom.validators.ts       # 自定义验证器
```

## 3. 模块依赖关系

### 3.1 前端模块依赖
- 所有功能模块依赖核心模块
- 共享模块被所有其他模块使用
- 服务模块提供数据层支持

### 3.2 后端模块依赖
- 业务模块依赖核心模块
- AI服务模块为其他业务模块提供AI能力
- 共享模块提供通用功能支持

## 4. 模块开发优先级

### 4.1 第一阶段：基础架构
1. 前端核心模块（认证、路由、状态管理）
2. 后端核心模块（配置、中间件、数据库）
3. 共享模块（类型定义、工具函数）

### 4.2 第二阶段：核心功能
1. 用户认证模块
2. 用户资料模块
3. 基础UI组件

### 4.3 第三阶段：业务功能
1. 行程规划模块
2. 预算管理模块
3. 地图导航模块

### 4.4 第四阶段：AI集成
1. AI服务模块
2. 语音识别集成
3. 智能推荐功能